{% extends "layout.html" %}

{% block container_setup %}
<div class="container-fluid">
{% endblock %}

{% block main_content %}
<div class="row" id="above_the_fold" style="margin-bottom: -3rem;">
    <div class="col-md-8 col-lg-6 p-5" id="review_content">
        <h1 class="gastromond big mb-5">Getting Unstuck in review</h1>

        {% for item in data["content"]: %}
        {% if "<div" in item: %}
        {{ item|safe }}
        {% else: %}
        <p>{{ item|safe }}</p>
        {% endif %}
        {% endfor %}
    </div>
    <div class="col-md-4 col-lg-6 px-0">
        <img src="/static/img/outall-75.jpg" alt="projects" class="w-100" style="opacity:.5; transition: .5s" id="img">
    </div>
</div>
{% endblock %}

{% block end_file %}
<script>
let opacity = (e) => {
    e.target.style.opacity = 1
}
let opacity2 = (e) => {
    e.target.style.opacity = .5
}

let img = document.getElementById("img");

img.addEventListener("mouseenter", opacity)
img.addEventListener("mouseleave", opacity2)
</script>
<script src="/static/js/sb.js"></script>

<script>

let get_stat = (identifier, stats) => {
    let parts = identifier.split("/");
    let value = stats;
    console.log(value)
    for (let i = 0; i < parts.length; i++) {
        console.log(parts[i])
        value = value[parts[i]];
    }

    return value;
};

let replace_stats = (stats) => {
    let elements = document.getElementsByClassName("stat");
    for (let i = 0; i < elements.length; i++) {
        elements[i].innerText = get_stat(elements[i].innerText, stats);
    }
};

let data = null;
let get_data = (cb) => {
    if (data === null) {
        handle_ajax("POST", "/summary", {}, (res) => {
            data = JSON.parse(res.responseText);
            replace_stats(data);

            if (cb !== null) {
                cb(data);
            }
        });
    }
    else {
        if (cb !== null) {
            cb(data);
        }

        return data;
    }
};

</script>

<script src="/static/js/d3.min.js"></script>
<script src="/static/js/topojson.v1.min.js"></script>
<script src="/static/js/queue.v1.min.js"></script>
<script src="/static/js/d3-tip.js"></script>
<script src="/static/js/country_map.js"></script>
<script>
    let p = new Promise((resolve, reject) => {
        get_data(resolve);
    }).then((d) => {
        let countries_data = d3.map();
        for (nation in data["nations"]) {
            countries_data.set(nation, data["nations"][nation]);
        }

        country_map(countries_data);
    });
</script>

{% endblock %}
